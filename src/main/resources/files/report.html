<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
          integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
          crossorigin="anonymous" referrerpolicy="no-referrer"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://unpkg.com/gridjs/dist/theme/mermaid.min.css" rel="stylesheet"/>
    <style>
        :root {
          --border-color: #d9d9d9;
          --passed-status-color: #008000;
          --failed-status-color: #e01e37;
          --skipped-status-color: #C0C0C0;
          --known-failures-status-color: #FFC300;
          --passed-with-known-failure-color: #73e2a7;
        }

        html {
          font-family: Roboto, Arial;
          margin-top: 0;
          margin-bottom: 0;
        }

        .content {
          display: flex;
          flex-direction: column;
          margin-top: 5px;
          margin-left: 20px;
          margin-right: 20px;
          margin-bottom: 0px;
        }

        .report-title {
          display: block;
          color: #03256c;
          font-weight: bold;
          font-size: larger;
          text-align: center;
        }

        .over-all-highlight-section {
          margin-right: 10px;
        }

        .over-all-highlight {
          height: 30px;
          color: white;
          font-size: large;
          font-weight: bolder;
          text-align: center;
          border-radius: 10px;
          padding-top: 5px;
        }

        .project-info-section {
          flex: 1;
          display: flex;
          flex-direction: column;
          border: solid;
          border-color: var(--border-color);
          border-width: 1px;
          margin-right: 10px;
          box-shadow: 2px 2px 15px 2px #C0C0C0;
          /* box-shadow: -1px 2px 5px -1px #C0C0C0; */
          border-radius: 15px;
          padding-bottom: 20px;
          margin-top: 18px;
          margin-bottom: 10px;
        }

        .project-info-header {
          flex: 1;
          font-weight: bold;
          color: #1d3557;
          text-align: left;
          padding-bottom: 8px;
          padding-top: 5px;
          margin-top: 10px;
          margin-left: 15px;
          margin-bottom: 10px;
        }

        .project-info-container {
          display: flex;
          flex-direction: row;
          justify-content: left;
          flex-wrap: wrap;
        }

        .project-info-content {
          flex: 1;
          display: grid;
          grid-template-columns: 120px 10px 1fr;
          color: #7d8597;
          column-gap: 4px;
          row-gap: 0px;
          padding-left: 10px;
          font-size: smaller;
          margin-top: 5px;
          margin-left: 15px;
        }

        .project-info-key {
          font-weight: 700;
        }

        .project-info-value {
          color: #8d99ae;
          height: fit-content;
        }

        .project-info-element {
          height: 15px;
          margin-top: 0px;
          margin-bottom: 0px;
          margin-left: 0px;
          margin-right: 0px;
          height: 20px;
        }

        .project-info-content-description-value {
          overflow: scroll;
          min-height: 150px;
          padding-right: 30px;
        }

        .chart-area {
          display: flex;
          flex-direction: row;
          flex-wrap: wrap;
          gap: 10px;
          margin-top: 10px;
          margin-bottom: 0px;
        }

        .chart-section-element {
          flex: 1;
          border: solid;
          border-color: var(--border-color);
          border-width: 1px;
          margin-right: 10px;
          box-shadow: 2px 2px 15px 2px #C0C0C0;
          /* box-shadow: -1px 2px 5px -1px #C0C0C0; */
          border-radius: 15px;
          padding-bottom: 20px;
        }

        .stats-tables {
          margin-top: 10px;
          display: flex;
          flex-direction: column;
          justify-content: space-between;
          margin-right: 10px;
          border-radius: 15px;
        }

        .overall-stats-header,
        .feature-stats-header {
          font-weight: bold;
          color: #1d3557;
          text-align: left;
          padding-bottom: 8px;
          padding-top: 5px;
        }

        .overall-stats-table,
        .feature-stats-table {
          box-shadow: 1px 1px 15px 2px #C0C0C0;
          /* box-shadow: -1px 2px 5px -1px #C0C0C0; */
          margin-top: 8px;
          border-radius: 15px;
        }

        .overall-stats-section,
        .feature-stats-section {
          margin-top: 20px;
          display: flex;
          flex-direction: column;
          justify-content: space-around;
          border-radius: 15px;;
        }

        table {
          width: 100%;
          border-collapse: collapse;
        }

        table th {
          width: fit-content;
          padding: 10px 0;
          background-color: #03045e;
          text-align: center;
          /* border: 0.2px solid #d4d4d4; */
          font-size: small;
          color: white;
        }

        table th:first-child {
          border-top-left-radius: 15px;
        }

        table th:last-child {
          border-top-right-radius: 15px;
        }

        table td {
          padding: 10px;
          border-top: 0.2px solid #d4d4d4;
          text-align: center;
          background-color: #ffffff;
          margin: 0px;
          font-size: smaller;
          color: #6c757d;
        }

        table tr:last-child td:first-child {
          border-bottom-left-radius: 15px;
        }

        table tr:last-child td:last-child {
          border-bottom-right-radius: 15px;
        }

        /* new */

        .complete-result-section-header {
          font-weight: bold;
          color: #1d3557;
          text-align: left;
          padding-bottom: 0px;
          padding-top: 5px;
          margin-top: 15px;
        }

        .complete-result-section {
          border-color: var(--border-color);
          border-width: 1px;
          margin-right: 10px;
          margin-top: 10px;
          box-shadow: 2px 2px 15px 2px #C0C0C0;
          border-radius: 15px;
          border-right: 0.5px solid var(--border-color);
          min-height: 700px;
        }

        .complete-result-container {
          margin-top: 0px;
          margin-bottom: 0px;
          margin-left: 0px;
        }

        section {
          display: -webkit-flex;
          /* Safari */
          display: flex;
          /* padding-right: 10px; */
          border-top-left-radius: 15px;
          border-bottom-left-radius: 15px;
        }

        nav {
          flex: auto;
          border-right: 0.5px solid var(--border-color);
          border-left: 0.5px solid var(--border-color);
          /* border-bottom: 0.5px solid var(--border-color); */
          border-top: none;
          padding-top: 10px;
          margin-top: 0px;
          margin-right: 0px;
          line-height: 40px;
          /* box-shadow: 2px 2px 15px 2px #C0C0C0; */
          background-color: white;
          min-height: 650px;
          border-top-left-radius: 15px;
          /* border-bottom-left-radius: 15px; */
        }

        nav ul {
          list-style-type: none;
          padding-top: 0px;
          padding-left: 0px;
          margin: 0px;
          border-bottom: none;
          border-top: none;
        }

        nav ul li {
          padding-top: 0px;
          border-bottom: 0.01px solid var(--border-color);
          border-left: none;
          border-right: none;
        }

        nav ul li span {
          color: #adb5bd;
          font-size: xx-small;
          border-left: none;
          border-right: none;
        }

        nav ul a {
          display: block;
          text-decoration: none;
          line-height: 30px;
          padding-left: 5px;
          font-size: small;
          color: black;
          cursor: pointer;
          border-left: none;
          border-right: none;
        }

        .side-nav-item {
          display: grid;
          grid-template-columns: 1fr 15% 5%;
          flex-wrap: nowrap;
          justify-content: space-between;
          align-items: first baseline;
          border-left: none;
          border-right: none;
        }

        .status-icon {
          font-size: 15px;
          padding-right: 10px;
          color: white;
        }

        .side-nav-item-active {
          border: 0.3px solid var(--border-color);
          background-color: #03045e;
          color: white;
        }

        .side-nav-item-active a {
          background-color: #03045e;
          color: white;
        }

        .feature-specific-sc-container {
          -webkit-flex: 1;
          /* Safari 6.1+ */
          -ms-flex: 1;
          /* IE 10 */
          flex: auto;
          margin-top: 0px;
          display: flex;
          flex-direction: column;
          justify-content: flex-start;
          row-gap: 10px;
          border-top: 0.1px solid var(--border-color);
          /* border-bottom: 0.1px solid var(--border-color); */
          border-right: 0.1px solid var(--border-color);
          border-left: none;
          padding: 10px;
          min-height: 650px;
          background-color: white;
          border-top-right-radius: 15px;
          /* border-bottom-right-radius: 15px; */
        }

        .displayOnClick {
          display: none;
        }

        .scenario-item-box {
          display: flex;
          flex-direction: column;
          justify-content: space-between;
          border: 0.1px solid var(--border-color);
          padding: 10px;
          box-shadow: 2px 2px 15px 2px #e3e2e2;
        }

        .scenario-item {
          font-size: smaller;
          display: flex;
          flex-direction: column;
          row-gap: 0px;
          border-right: 0.1px solid var(--border-color);
          border-left: 0.1px solid var(--border-color);
          border-bottom: 0.1px solid var(--border-color);
          /* border: 0.1px solid var(--border-color); */
        }

        .scenario-name {
          height: 40px;
          display: flex;
          flex-direction: row;
          justify-content: space-between;
          /* background-color: #fefefa; */
          align-items: center;
          padding-left: 10px;
          border-bottom: 0.1px solid var(--border-color);
          border-top: 0.1px solid var(--border-color);
          cursor: pointer;
        }

        .scenario-hook-section {
          height: fit-content;
          display: grid;
          grid-template-columns: 20% 1fr;
          padding-left: 10px;
          border: 0.1px solid var(--border-color);
          cursor: pointer;
          background-color: #f4acb7;
          color: white;
          line-height: 18px;
          font-size: small;
        }

        .scenario-hook-key {
          flex: 30%
        }

        .scenario-expand-icon {
          margin-right: 20px;
        }

        .step-items {
          display: none;
          flex-direction: column;
          justify-content: space-between;
          row-gap: 10px;
          margin-left: 20px;
          margin-top: 10px;
          margin-right: 10px;
          border: 0.1px solid var(--border-color);
          margin-bottom: 10px;
          padding: 10px;
          box-shadow: 2px 2px 15px 2px #e3e2e2;
        }

        .step-item {
          line-height: 40px;
          padding-left: 0px;
          border: 0.1px solid var(--border-color);
          cursor: pointer;
          display: flex;
          flex-direction: column;
          justify-content: space-between;
          box-shadow: 2px 2px 15px 2px #e3e2e2;
        }

        .step-name {
          border-bottom: 0.1px solid var(--border-color);
          /* border-top: 0.1px solid var(--border-color); */
          padding-left: 20px;
          display: flex;
          flex-direction: row;
          justify-content: space-between;
          align-items: center;
          padding-right: 30px;
        }

        .step-hook-error-section {
          flex: 1;
          display: flex;
          flex-direction: row;
          justify-content: left;
          background-color: #f4acb7;
          color: white;
          line-height: 18px;
          height: fit-content;
        }

        .step-info-section {
          display: none;
          flex-direction: column;
          justify-content: space-between;
          margin-bottom: 10px;
          margin-left: 40px;
          margin-top: 10px;
          margin-right: 10px;
          padding-left: 0px;
          border: 0.1px solid var(--border-color);
        }

        .step-error {
          background-color: #f4acb7;
          color: white;
          line-height: 18px;
          display: block;
          padding: 10px;
        }

        .embedding-name {
          background-color: #f5edf0;
          padding-left: 20px;
        }

        .embedding-src {
          padding-left: 40px;
          color: #2660a4;
        }

        img {
          height: 100px;
          width: 150px;
        }
    </style>
    <title>EasyCucumberReport</title>
</head>

<body>

<div class="content">
    <!-- Title -->
    <div class="report-title">
        <p>Cucumber Easy Report</p>
    </div>

    <!-- Overall Status Highlight -->
    <div class="over-all-highlight-section"></div>

    <!-- project info section -->
    <div class="project-info-section">
        <div>
            <div class="project-info-header">Project Information</div>
        </div>

        <div class="project-info-container">
            <div class="project-info-content" id="project-info-content-details-a"></div>
            <div class="project-info-content" id="project-info-content-details-b"></div>
            <div class="project-info-content" id="project-info-content-description"></div>
        </div>

    </div>

    <!-- Chart Area -->
    <div class="chart-area">

        <div class="chart-section-element feature-pie-chart-section">
            <div class="pie-chart">
                <canvas id="featurePieChart"></canvas>
            </div>
        </div>

        <div class="chart-section-element testcase-pie-chart-section">
            <div class="pie-chart">
                <canvas id="testCasePieChart"></canvas>
            </div>
        </div>

        <div class="chart-section-element testcase-pie-chart-section">
            <div class="pie-chart">
                <canvas id="testStepePieChart"></canvas>
            </div>
        </div>

    </div>

    <!-- stats table-->
    <div class="stats-tables">
        <!-- it shows overall status-->
        <div class="overall-stats-section">
            <div class="overall-stats-header">Overall Summary</div>
            <div class="overall-stats-table">
                <table>
                    <thead>
                    <tr>
                        <th>Total Cases</th>
                        <th>Passed</th>
                        <th>Failed</th>
                        <th>Skipped</th>
                        <th>Known Failures</th>
                        <th>Passed With Known Failures</th>
                        <th>Pass %</th>
                        <th>Fail %</th>
                        <th>Skipped %</th>
                        <th>Known Fail %</th>
                        <th>Passed With Known Fail %</th>
                        <th>Status</th>
                        <th>Executed Time</th>
                    </tr>
                    </thead>

                    <tbody id="overall-stats-data-output">

                    </tbody>
                </table>
            </div>
        </div>

        <!-- it shows featurewise stats-->
        <div class="feature-stats-section">
            <div class="feature-stats-header">Features Summary</div>
            <div class="feature-stats-table">
                <table>
                    <thead>
                    <tr>
                        <th>Feature Name</th>
                        <th>Total Cases</th>
                        <th>Passed</th>
                        <th>Failed</th>
                        <th>Skipped</th>
                        <th>Known Failures</th>
                        <th>Passed With Known Failures</th>
                        <th>Pass %</th>
                        <th>Fail %</th>
                        <th>Skipped %</th>
                        <th>Known Fail %</th>
                        <th>Passed With Known Fail %</th>
                        <th>Status</th>
                        <th>Executed Time</th>
                    </tr>
                    </thead>

                    <tbody id="feature-stats-data-output">
                    <!-- user JS to inset table row elements here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Feature, scenarios and its steps along with execution error details and screenshots -->
    <div class="complete-result-section-header">Test Results</div>
    <div id="complete-result-section" class="complete-result-section"></div>
</div>

<script src="https://unpkg.com/gridjs/dist/gridjs.umd.js"></script>
<script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
<script>
    var json = `
    <<json-input>>
`;

// Read Json Data
var data = JSON.parse(json);

// populate overall status on top of the report
let overallStatusParentElement = document.querySelector(".over-all-highlight-section");
var overAllStatusInnerElement = " ";
var overallStatus = data.overAllExecutionStatus;
if (overallStatus == "passed") {
  overAllStatusInnerElement = `<div class="over-all-highlight" style="background-color:#008000;">${overallStatus}</div>`;
} else if (overallStatus == "failed") {
  overAllStatusInnerElement = `<div class="over-all-highlight" style="background-color:#e01e37;">${overallStatus}</div>`;
} else if (overallStatus == "skipped") {
  overAllStatusInnerElement = `<div class="over-all-highlight" style="background-color:#C0C0C0 ; color:white; font-weight:bold;">${overallStatus}</div>`;
} else if (overallStatus == "known failures") {
  overAllStatusInnerElement = `<div class="over-all-highlight" style="background-color:#FFC300 ; color:#008000; font-weight:bold;">${overallStatus}</div>`;
} else if (overallStatus == "passed with known failures") {
  overAllStatusInnerElement = `<div class="over-all-highlight" style="background-color:#85e74d ; color:white; font-weight:bold;">${overallStatus}</div>`;
} else {
  overAllStatusInnerElement = `<div class="over-all-highlight" style="background-color:#C0C0C0 ; color:white; font-weight:bold;">No Results Found</div>`;
}

overallStatusParentElement.innerHTML = overAllStatusInnerElement;

// project info section
var projectInfo = data.projectInfo;

// project into content column a
let projectInfoContentDetailsParentElement = document.querySelector("#project-info-content-details-a");
var projectInfoContentDetailsInnerElement = " ";

projectInfoContentDetailsInnerElement = `
<div class="project-info-element project-info-key">Environment</div>
<div class="project-info-element project-info-separator">:</div>
<div class="project-info-element project-info-value">${projectInfo.environment}</div>

<div class="project-info-element project-info-key">Browser</div>
<div class="project-info-element project-info-separator">:</div>
<div class="project-info-element project-info-value">${projectInfo.browser}</div>

<div class="project-info-element project-info-key">Application</div>
<div class="project-info-element project-info-separator">:</div>
<div class="project-info-element project-info-value">${projectInfo.appName}</div>

<div class="project-info-element project-info-key">OS</div>
<div class="project-info-element project-info-separator">:</div>
<div class="project-info-element project-info-value">${projectInfo.os}</div>

`;

projectInfoContentDetailsParentElement.innerHTML = projectInfoContentDetailsInnerElement;

// project info content column b

let projectInfoContentDetailsBParentElement = document.querySelector("#project-info-content-details-b");
var projectInfoContentDetailsBInnerElement = " ";

projectInfoContentDetailsBInnerElement = `
<div class="project-info-element project-info-key">Start Time</div>
<div class="project-info-element project-info-separator">:</div>
<div class="project-info-element project-info-value">${projectInfo.startTime}</div>

<div class="project-info-element project-info-key">End Time</div>
<div class="project-info-element project-info-separator">:</div>
<div class="project-info-element project-info-value">${projectInfo.endTime}</div>

<div class="project-info-element project-info-key">Elapsed Time</div>
<div class="project-info-element project-info-separator">:</div>
<div class="project-info-element project-info-value">${projectInfo.totalDuration}</div>

`;

projectInfoContentDetailsBParentElement.innerHTML = projectInfoContentDetailsBInnerElement;

// project info content column c

let projectInfoContentDescriptionParentElement = document.querySelector("#project-info-content-description");
var projectInfoContentDescriptionInnerElement = " ";

projectInfoContentDescriptionInnerElement = `
<div class="project-info-element project-info-key">Description</div>
<div class="project-info-element project-info-separator">:</div>
<div class="project-info-element project-info-value project-info-content-description-value">${projectInfo.description}</div>

`;

projectInfoContentDescriptionParentElement.innerHTML = projectInfoContentDescriptionInnerElement;

// Load pie charts for feature, test case and test steps on loading the page
// refer Chart.js library : https://www.chartjs.org/docs/latest/samples/other-charts/doughnut.html
window.onload = function () {

  // feature pie chart
  let featureLabels = ["Passed", "Failed", "Skipped", "Known Failures", "Passed With Known Failures"];
  let featurePieDataSet = [
    data.featurePieChartDataMap.passed,
    data.featurePieChartDataMap.failed,
    data.featurePieChartDataMap.skipped,
    data.featurePieChartDataMap.knownFailures,
    data.featurePieChartDataMap.passedWithKnownFailures
  ];

  const featurePieData = {
    labels: featureLabels,
    datasets: [{
      data: featurePieDataSet,
      backgroundColor: [
        '#25a244',
        '#d80032',
        '#c0d6df',
        '#ffc43d',
        '#73e2a7'
      ]
    }]
  };

  const featurePieConfig = {
    type: 'doughnut',
    data: featurePieData,
    options: {
      maintainAspectRatio: false,
      responsive: true,
      legend: {
        position: 'right'
      },
      title: {
        display: true,
        text: 'Feature Status'
      },
      plugins: {

      }
    }
  };

  const featurePieChart = new Chart(
    document.getElementById('featurePieChart'),
    featurePieConfig
  );

  // testcase pie chart
  let testCaseLabels = ["Passed", "Failed", "Skipped", "Known Failures", "Passed With Known Failures"];
  let testCasePieDataSet = [
    data.testCasePieChartDataMap.passed,
    data.testCasePieChartDataMap.failed,
    data.testCasePieChartDataMap.skipped,
    data.testCasePieChartDataMap.knownFailures,
    data.testCasePieChartDataMap.passedWithKnownFailures
  ];

  const testCasePieData = {
    labels: testCaseLabels,
    datasets: [{
      data: testCasePieDataSet,
      backgroundColor: [
        '#25a244',
        '#d80032',
        '#c0d6df',
        '#ffc43d',
        '#73e2a7'
      ]
    }]
  };

  const testCasePieConfig = {
    type: 'doughnut',
    data: testCasePieData,
    options: {
      maintainAspectRatio: false,
      responsive: true,
      legend: {
        display: true,
        position: 'right'
      },
      title: {
        display: true,
        text: 'TestCase Status'
      },
      plugins: {

      }
    }
  };

  const testCasePieChart = new Chart(
    document.getElementById('testCasePieChart'),
    testCasePieConfig
  );

  // testcase pie chart
  let testStepLabels = ["Passed", "Failed", "Skipped", "Known Failures", "Pending", "Undefined", "Ambiguous", "Unused"];
  let testStepPieDataSet = [
    data.testStepPieChartDataMap.passed,
    data.testStepPieChartDataMap.failed,
    data.testStepPieChartDataMap.skipped,
    data.testStepPieChartDataMap.knownFailures,
    data.testStepPieChartDataMap.pending,
    data.testStepPieChartDataMap.undefined,
    data.testStepPieChartDataMap.ambiguous,
    data.testStepPieChartDataMap.unused,
  ];

  const testStepPieData = {
    labels: testStepLabels,
    datasets: [{
      data: testStepPieDataSet,
      backgroundColor: [
        '#25a244',
        '#d80032',
        '#c0d6df',
        '#ffc43d',
        '#f72585',
        '#124559',
        '#aed9e0',
        '#8a817c'
      ]
    }]
  };

  const testStepPieConfig = {
    type: 'doughnut',
    data: testStepPieData,
    options: {
      maintainAspectRatio: false,
      responsive: true,
      legend: {
        display: true,
        position: 'right'
      },
      title: {
        display: true,
        text: 'TestStep Status'
      }
    }
  };

  const testStepPieChart = new Chart(
    document.getElementById('testStepePieChart'),
    testStepPieConfig
  );

}

// load feature stats table - starts
let featureStatsTable = document.querySelector("#feature-stats-data-output");
let out = "";
var featuresList = data.featuresStats;

for (let feature of featuresList) {
  var statusCell = "";
  if (feature.status == "passed") {
    statusCell = `<td style="color:#008000; font-weight:bold;">${feature.status}</td>`;
  } else if (feature.status == "failed") {
    statusCell = `<td style="color:#e01e37; font-weight:bold;">${feature.status}</td>`;
  } else if (feature.status == "skipped") {
    statusCell = `<td style="color:#C0C0C0; font-weight:bold;">${feature.status}</td>`;
  } else if (feature.status == "known failures") {
    statusCell = `<td style="color:#FFC300; font-weight:bold;">${feature.status}</td>`;
  } else if (feature.status == "passed with known failures") {
    statusCell = `<td style="color:#73e2a7; font-weight:bold;">${feature.status}</td>`;
  } else {
    statusCell = `<td>${feature.status}</td>`;
  }

  out += `

  <tr>
    <td style="text-align: left">${feature.featureName}</td>
    <td>${feature.totalCases}</td>
    <td>${feature.passed}</td>
    <td>${feature.failed}</td>
    <td>${feature.skipped}</td>
    <td>${feature.knownFailures}</td>
    <td>${feature.passedWithKnownFailures}</td>
    <td>${feature.passPercent}</td>
    <td>${feature.failPercent}</td>
    <td>${feature.skippedPercent}</td>
    <td>${feature.knownFailPercent}</td>
    <td>${feature.passedWithKnownFailPercent}</td>

    ${statusCell}


    <td>${feature.duration}</td>
  </tr>

  `;
  featureStatsTable.innerHTML = out;
}
// load feature stats table - ends

// load overall testcase stats table - starts
let overallTestCaseStatsTable = document.querySelector("#overall-stats-data-output");
let overAllTestCaseTableOut = "";
var overallTestCaseData = data.overallTestCaseStats;

var statusCell = "";
var overallStatus = overallTestCaseData.overAllStatus;
if (overallStatus == "passed") {
  statusCell = `<td style="color:#008000; font-weight:bold;">${overallStatus}</td>`;
} else if (overallStatus == "failed") {
  statusCell = `<td style="color:#e01e37; font-weight:bold;">${overallStatus}</td>`;
} else if (overallStatus == "skipped") {
  statusCell = `<td style="color:#C0C0C0; font-weight:bold;">${overallStatus}</td>`;
} else if (overallStatus == "known failures") {
  statusCell = `<td style="color:#FFC300; font-weight:bold;">${overallStatus}</td>`;
} else if (overallStatus == "passed with known failures") {
  statusCell = `<td style="color:#73e2a7; font-weight:bold;">${overallStatus}</td>`;
} else {
  statusCell = `<td>${feature.status}</td>`;
}

overAllTestCaseTableOut = `

  <tr>
    <td>${overallTestCaseData.totalCases}</td>
    <td>${overallTestCaseData.passed}</td>
    <td>${overallTestCaseData.failed}</td>
    <td>${overallTestCaseData.skipped}</td>
    <td>${overallTestCaseData.knownFailures}</td>
    <td>${overallTestCaseData.passedWithKnownFailures}</td>
    <td>${overallTestCaseData.passPercent}</td>
    <td>${overallTestCaseData.failPercent}</td>
    <td>${overallTestCaseData.skippedPercent}</td>
    <td>${overallTestCaseData.knownFailPercent}</td>
    <td>${overallTestCaseData.passedWithKnownFailPercent}</td>

    ${statusCell}


    <td>${overallTestCaseData.overallDuration}</td>
  </tr>

  `;
overallTestCaseStatsTable.innerHTML = overAllTestCaseTableOut;
// load overall testcase stats table - ends


// Display features, its scenarios, its steps and its screenshots
var features = data.featureMapList;

// it consist of whole elements
var completeResultSectionParentElement = document.querySelector("#complete-result-section");
var featureListElement = getFeatureElements(features);
var content = getContentToDisplayOnRightWhenClickingFeatureNavLink(features);
var testResultSectionContainerElement = `

  <section class="complete-result-container">
    <nav>
      <ul>
        ${featureListElement}
      </ul>
    </nav>

    <div class="feature-specific-sc-container" id="loadOnClick" style="width:70%; float: right;">

    </div>
  </section>

  ${content}

  `;

completeResultSectionParentElement.innerHTML = testResultSectionContainerElement;

$(document).ready(function () { $("img").click(function () { this.requestFullscreen() }) });

function getContentToDisplayOnRightWhenClickingFeatureNavLink(features) {
  var displayOnClickContent = "";
  for (let feature of features) {
    // get all scenario elements to be displayed on right side page
    var scenarioElements = getScenarioElements(feature.scenarios);

    // then build the content panel section with above scenario elements
    // for every feature
    displayOnClickContent += `
      <div id="${feature.id}" class="displayOnClick">
        ${scenarioElements}
      </div>
      `;
  }
  return displayOnClickContent;
}

function getFeatureElements(features) {
  var featureListElement = "";
  for (let feature of features) {
    var statusCell = getFeatureNavigationLineStatusColor(feature.status);
    var featureId = replaceEscapesAndHtmlWithHyphen(feature.id);

    // prepare left side features link as li
    featureListElement += `
    <li class="side-nav-item">
      <a
        id="${featureId}-a"
        href="#${featureId}"
        class="featureLinks"
        onclick='loadScenarioContent("#${featureId}")'>
        ${feature.name}
      </a>
      <span>${feature.duration}</span>
      ${statusCell}
    </li>
    `;
  }
  return featureListElement;
}

function getScenarioElements(scenarios) {
  var scenarioElements = "";
  var i = 1;
  for (let scenario of scenarios) {
    var steps = scenario.steps;
    var stepElements = getStepElements(steps);
    var scLineColor = getScenarioLineColorBasedOnStatus(scenario.status);
    var scenarioId = replaceEscapesAndHtmlWithHyphen(scenario.id);

    var beforeScenarioError = "";
    if(scenario.beforeError.length != 0) {
      beforeScenarioError = `
        <div class="scenario-hook-section">
          <div class="scenario-hook-key">Scenario ${i} BeforeScenario-Hook-Error : </div>
          <div>${scenario.beforeError}</div>
        </div>
      `;
    }

    var afterScenarioError = "";
    if(scenario.afterError.length != 0) {
      afterScenarioError = `
        <div class="scenario-hook-section">
          <div class="scenario-hook-key">Scenario ${i} AfterScenario-Hook-Error : </div>
          <div>${scenario.afterError}</div>
        </div>
      `;
    }

    // Below is a box of scenario line and its steps details.
    // By default, steps are hidden [display : none]
    // On clicking scenario line, step is displayed
    scenarioElements += `
    <div class="scenario-item-box">
        ${beforeScenarioError}
        <div id="#${scenarioId}" class="scenario-item">
          <div id="#${scenarioId}-collapsible" class="scenario-name collapsible" onclick="collapseExpandScenario('#${scenarioId}-collapsible-content')">
            <div ${scLineColor}>Scenario ${i} : ${scenario.name}</div>
            <span class="fa-solid fa-angle-down scenario-expand-icon" style="color: #9eb3c2;"></span>
          </div>
          <div id="#${scenarioId}-collapsible-content" class="step-items">
            ${stepElements}
          </div>
        </div>
        ${afterScenarioError}
    </div>
      `;
      i++;
  }
  return scenarioElements;
}

function getStepElements(steps) {
  var stepElements = "";
  var i = 1;
  for (let step of steps) {
    var stepLineColor = getStepLineColorBasedOnStatus(step.status);
    var beforeStepError = "";
    if(step.beforeError.length != 0) {
      beforeStepError = `
        <div class="step-name">
          <div class="step-hook-error-section">
            <div>Step ${i} BeforeStep-Hook-Error : </div>
            <div>${step.beforeError}</div>
          </div>
        </div>
      `;
    }

    var afterStepError = "";
    if(step.afterError.length != 0) {
      afterStepError = `
      <div class="step-name">
        <div class="step-hook-error-section">
          <div>Step ${i} AfterStep-Hook-Error : </div>
          <div>${step.afterError}</div>
        </div>
      </div>
      `;
    }

    var stepError = "";

    if (step.error != null) {
      stepError = `
        <div class="step-error">${step.error}</div>
      `;
    }

    var stepEmbeddings = getStepEmbeddingElements(step.embeddings, step.status);
    var stepName = step.name;
    var stepNameForId = replaceEscapesAndHtmlWithHyphen(stepName);

    stepElements += `
      <div id="#${stepNameForId}-${step.line}" class="step-item">
        ${beforeStepError}
        <div
          id="#step-${stepNameForId}-${step.line}-collapsible"
          class="step-name" ${stepLineColor}
          onclick="collapseExpandStep('#step-${stepNameForId}-${step.line}-collapsible-content')">
            <div>Step ${i} : ${stepName}</div>
            <div><i class="fa-sharp fa-solid fa-circle"></i></div>
        </div>

        <div
          id="#step-${stepNameForId}-${step.line}-collapsible-content"
          class="step-info-section">
            ${stepError}
            ${stepEmbeddings}
        </div>
        ${afterStepError}
      </div>
    `;
    i++;
  }
  return stepElements;
}

function replaceEscapesAndHtmlWithHyphen(value) {
  return value.replaceAll("<br>", "-")
    .replaceAll("&emsp", "-")
    .replaceAll("'", "-")
    .replaceAll(";", "-")
    .replaceAll(" ", "-");
}

function getStepEmbeddingElements(embeddings, stepStatus) {
  var stepEmbeddingElement = "";
  if (embeddings != null && embeddings.length > 0) {
    for (let embedding of embeddings) {
      var attachmentSource = getStepScreenshotElement(embedding.mime_type, embedding.data);
      if (isStepStatusIngnorable(stepStatus)) {
        stepEmbeddingElement += `
          <div>
          <div class="embedding-name">${embedding.name}</div>
          <div class="embedding-src">${attachmentSource}</div>
          <div class="embedding-name">${stepStatus} step</div>
          </div>
        `;
      } else {
        stepEmbeddingElement += `
          <div>
            <div class="embedding-name">${embedding.name}</div>
            <div class="embedding-src">${attachmentSource}</div>
          </div>
        `;
      }
    }
  } else {
    stepEmbeddingElement += `
          <div>
            <div class="embedding-name">${stepStatus}</div>
          </div>
        `;
  }

  return stepEmbeddingElement;
}

function getStepScreenshotElement(mimeType, encodedString) {
  if (mimeType == "text/plain") {
    return `<div>${encodedString}</div>`;
  } else {
    var uint8array = new TextEncoder("utf-8").encode(encodedString);
    var text = new TextDecoder().decode(uint8array);
    return `<img src="data:${mimeType};base64, ${text}" alt="unable to find image source">`;
  }
}

function isStepStatusIngnorable(stepStatus) {
  const ignorableStatuses = ['skipped', 'pending', 'undefined', 'ambiguous', 'unused'];
  return ignorableStatuses.includes(stepStatus);
}

// On selecting any feature link from left side navigation,
// clearing backgroup of other features
// add background only for selected feature
function loadScenarioContent(selector) {
  $("#loadOnClick").html($(selector).html());

  $("ul > li > a").on("click", function () {
    $("ul li a").css("color", "black");
    $("ul li a").css("background-color", "transparent");
    $("ul li a").css("border", "none");

    $("ul li").css("color", "black");
    $("ul li").css("background-color", "transparent");

    $(this).css("color", "white");
    $(this).css("background-color", "#03045e");
    $(this.parentNode).css("background-color", "#03045e");
  });
};

// when document becomes ready, it selects and highlights
// the first feature navigation option
$(document).ready(function () {
  var firstFeatureId = features[0].id
  document.querySelector("li a[href='#" + features[0].id + "']").parentNode.classList.add("side-nav-item-active");
  loadScenarioContent("#" + firstFeatureId);

});

function collapseExpandScenario(id) {

  if (document.getElementById(id).style.display == "flex") {
    document.getElementById(id).style.display = "none";
  } else {
    document.getElementById(id).style.display = "flex";
  }
}

function collapseExpandStep(id) {

  if (document.getElementById(id).style.display == "block") {
    document.getElementById(id).style.display = "none";
  } else {
    document.getElementById(id).style.display = "block";
  }
}

// jquery to click and open any image in fullscreen view
// pressing escape will close image
// $(document).ready(function () { $("img").click(function () { this.requestFullscreen() }) });
$('img').on("click",function(){
  var win = window.open();
  var url = $(this).attr("src");
  var html = $("body").html("<textarea>" + url +"</textarea>");
  $(win.document.body).html(html);
});

function getFeatureNavigationLineStatusColor(featureStatus) {
  var statusCell = "";
  if (featureStatus == "passed") {
    statusCell = `<i class="fa-solid fa-circle-check status-icon" style="color: #0e920c;"></i>`;
  } else if (featureStatus == "failed") {
    statusCell = `<i class="fa-solid fa-circle-xmark status-icon" style="color: #f20202;"></i>`;
  } else if (featureStatus == "skipped") {
    statusCell = `<i class="fa-solid fa-circle-arrow-right status-icon" style="color: #c3c6cb;"></i>`;
  } else if (featureStatus == "known failures") {
    statusCell = `<i class="fa-solid fa-circle-exclamation status-icon" style="color: #f0cf75;"></i>`;
  } else if (featureStatus == "passed with known failures") {
    statusCell = `<i class="fa-solid fa-circle-exclamation status-icon" style="color: #73e2a7;"></i>`;
  } else {
    statusCell = "";
  }
  return statusCell;
}

function getStepLineColorBasedOnStatus(stepStatus) {
  var stepLineColor = "";
  if (stepStatus == "passed") {
    stepLineColor = "style='color: #008000'";
  } else if (stepStatus == "failed") {
    stepLineColor = "style='color: #e01e37'";
  } else if (stepStatus == "skipped") {
    stepLineColor = "style='color: #C0C0C0'";
  } else if (stepStatus == "known failures") {
    stepLineColor = "style='color: #FFC300'";
  } else if (stepStatus == "pending") {
    stepLineColor = "style='color: #f72585'";
  } else if (stepStatus == "undefined") {
    stepLineColor = "style='color: #124559'";
  } else if (stepStatus == "ambiguous") {
    stepLineColor = "style='color: #aed9e0'";
  } else if (stepStatus == "unused") {
    stepLineColor = "style='color: #8a817c'";
  }
  return stepLineColor;
}

function getScenarioLineColorBasedOnStatus(scenarioStatus) {
  var scLineColor = "";
  if (scenarioStatus == "passed") {
    scLineColor = "style='color: #008000'";
  } else if (scenarioStatus == "failed") {
    scLineColor = "style='color: #e01e37'";
  } else if (scenarioStatus == "skipped") {
    scLineColor = "style='color: #C0C0C0'";
  } else if (scenarioStatus == "known failures") {
    scLineColor = "style='color: #FFC300'";
  } else if (scenarioStatus == "passed with known failures") {
    scLineColor = "style='color: #73e2a7'";
  }
  return scLineColor;
}

</script>

</body>

</html>