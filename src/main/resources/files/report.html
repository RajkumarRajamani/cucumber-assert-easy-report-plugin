<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="icon"
          href="https://lh6.googleusercontent.com/8l_RChnDWOMe4cSRQgKGCUxgSpZMG3SFJD1DMz0ib-smItV-nJztVWsQMsMkUoGV_MlwQ9sj_l_M7G0qTkjW4wk">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
          integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
          crossorigin="anonymous" referrerpolicy="no-referrer"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Chart.js : main library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Chart.js : additional plugin : chartjs-plugin-labels -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-datalabels/2.2.0/chartjs-plugin-datalabels.min.js"
            integrity="sha512-JPcRR8yFa8mmCsfrw4TNte1ZvF1e3+1SdGMslZvmrzDYxS69J7J49vkFL8u6u8PlPJK+H3voElBtUCzaXj+6ig=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://unpkg.com/chart.js-plugin-labels-dv/dist/chartjs-plugin-labels.min.js"></script>

    <!-- Chart.js : additional plugin : chartjs-plugin-labels-dv -->
    <script src="https://unpkg.com/chart.js-plugin-labels-dv/dist/chartjs-plugin-labels.min.js"></script>


    <!-- Gird.js library -->
    <link href="https://unpkg.com/gridjs/dist/theme/mermaid.min.css" rel="stylesheet"/>

    <!-- lightbox2.css : to view images on pop-up -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/css/lightbox.css"
          integrity="sha512-Woz+DqWYJ51bpVk5Fv0yES/edIMXjj3Ynda+KWTIkGoynAMHrqTcDUQltbipuiaD5ymEo9520lyoVOo9jCQOCA=="
          crossorigin="anonymous" referrerpolicy="no-referrer"/>
    <style>
        :root {
          --border-color: #d9d9d9;
          --passed-status-color: #008000;
          --failed-status-color: #e01e37;
          --skipped-status-color: #C0C0C0;
          --known-failures-status-color: #FFC300;
          --passed-with-known-failure-color: #73e2a7;
        }

        html {
          font-family: Roboto, Arial;
          margin-top: 0;
          margin-bottom: 0;
          font-size: small;
        }

        .content {
          display: flex;
          flex-direction: column;
          margin-top: 5px;
          margin-left: 20px;
          margin-right: 20px;
          margin-bottom: 0px;
        }

        .report-title {
          display: block;
          color: #03256c;
          font-weight: bold;
          font-size: larger;
          text-align: center;
        }

        .logo {
          height: 30px;
          width: 60px;
          float: left;
          border-radius: 10px;
        }

        .version {
          font-size: smaller;
          color: dimgray;
          font-weight: lighter;
        }

        .over-all-highlight-section {
          margin-right: 10px;
        }

        .over-all-highlight {
          height: 30px;
          color: white;
          font-size: large;
          font-weight: bolder;
          text-align: center;
          border-radius: 10px;
          padding-top: 5px;
        }

        .project-info-header {
          font-weight: bold;
          color: #1d3557;
          text-align: left;
          padding-bottom: 8px;
          padding-top: 5px;
          margin-top: 10px;
        }




        /* new project details section */
        .project-details-container {
          display: block;
          padding: 20px;
          margin-top: 0px;
          margin-right: 10px;
          background-color: #eaecf0;
          border-radius: 8px;
        }

        .project-info-flex {
          display: flex;
          flex-direction: row;
          justify-content: space-between;
          background-color: white;
          padding: 15px;
          border-radius: 8px;
          column-gap: 30px;
        }

        .info-section {
          display: grid;
          grid-template-columns: 120px 5px 1fr;
          row-gap: 10px;
          column-gap: 10px;
          align-items: start;
          max-width: 33%;
        }

        .project-info-element {
          max-height: 30px;
          padding: 5px;
        }

        .project-info-key {
          font-weight: 700;
          color: #0b3954;
          max-width: 100%;
        }

        .project-info-value {
          color: #8d99ae;
          min-width: 200px;
          max-width: 100%;
          max-height: fit-content;
          overflow: visible;
        }

        .description-section {
          background-color: white;
          padding: 15px;
          margin-top: 5px;
          border-radius: 8px;
        }

        .project-desc-header {
          margin-bottom: 10px;
        }

        .project-desc-value {
          max-height: 150px;
          overflow: scroll;
        }

        .chart-section-header {
          margin-top: 10px;
          font-weight: bold;
          color: #1d3557;
          text-align: left;
          padding-bottom: 8px;
          padding-top: 5px;
        }

        .chart-area {
          display: flex;
          flex-direction: row;
          flex-wrap: wrap;
          gap: 10px;
          margin-top: 0px;
          margin-bottom: 0px;
          background-color: #eaecf0;
          padding: 20px;
          margin-right: 10px;
          border-radius: 8px;
        }

        .chart-section-element {
          flex: 1;
          border: solid;
          border-color: var(--border-color);
          border-width: 1px;
          box-shadow: 0px 2px 15px 2px #efeeee;
          border-radius: 15px;
          padding-top: 10px;
          background-color: white;
        }

        .pie-chart {
          padding: 0px;
          height: 200px;
        }

        .stats-tables {
          margin-top: 10px;
          display: flex;
          flex-direction: column;
          justify-content: space-between;
          margin-right: 10px;
          border-radius: 15px;
        }

        .overall-stats-header,
        .feature-stats-header {
          font-weight: bold;
          color: #1d3557;
          text-align: left;
          padding-bottom: 8px;
          padding-top: 5px;
        }

        .overall-stats-section,
        .feature-stats-section {
          margin-top: 20px;
          display: flex;
          flex-direction: column;
          justify-content: space-around;
          border-radius: 15px;
        }

        .complete-result-section-header {
          font-weight: bold;
          color: #1d3557;
          text-align: left;
          padding-bottom: 0px;
          padding-top: 5px;
          margin-top: 15px;
        }

        .complete-result-section-container {
          margin-top: 10px;
          margin-right: 10px;
          padding: 20px;
          background-color: #eaecf0;
          border-radius: 8px;
        }

        .complete-result-section {
          border-color: var(--border-color);
          border-width: 1px;
          margin-top: 10px;
          box-shadow: 2px 2px 10px 2px #9DB2BF;
          border-radius: 15px;
          border-right: 0.5px solid var(--border-color);
          min-height: 700px;
        }

        .feature-column,
        .scenario-and-step-results-column {
          height: 20px;
          background-color: #6B728E;
          color: white;
          /* margin: 8px; */
          padding-top: 5px;
          padding-bottom: 3px;
          text-align: center;
          align-items: center;
          border-radius: 4px;
          ;
        }

        .scenario-and-step-results-column {
          margin-right: 10px;
        }

        section {
          display: grid;
          grid-template-columns: 30% 70%;
          row-gap: 10px;
          column-gap: 10px;
          padding: 10px;
          background-color: white;
          border-radius: 8px;

        }

        nav {
          flex: auto;
          border: 0.5px solid var(--border-color);
          border-top: none;
          margin-top: 0px;
          margin-right: 0px;
          line-height: 40px;
          background-color: white;
          min-height: 650px;
          border-radius: 8px;
        }

        nav ul {
          list-style-type: none;
          padding-top: 0px;
          padding-left: 0px;
          margin: 0px;
          border-bottom: none;
          border-top: none;
        }

        nav ul li {
          padding-top: 0px;
          border-bottom: 0.01px solid var(--border-color);
          border-left: none;
          border-right: none;
        }

        nav ul li:first-child,
        nav ul li:first-child a {
          border-top-left-radius: 8px;
          border-top-right-radius: 8px;
        }

        nav ul li span {
          color: #adb5bd;
          font-size: xx-small;
          border-left: none;
          border-right: none;
        }

        nav ul a {
          display: block;
          text-decoration: none;
          line-height: 30px;
          padding-left: 5px;
          font-size: small;
          color: black;
          cursor: pointer;
          border-left: none;
          border-right: none;
        }

        .side-nav-item {
          display: grid;
          grid-template-columns: 1fr 15% 5%;
          flex-wrap: nowrap;
          justify-content: space-between;
          align-items: first baseline;
          border-left: none;
          border-right: none;
        }

        .status-icon {
          font-size: 15px;
          padding-right: 10px;
          color: white;
        }

        .side-nav-item-active {
          border: 0.3px solid var(--border-color);
          background-color: #03045e;
          color: white;
        }

        .side-nav-item-active a {
          background-color: #03045e;
          color: white;
        }

        .feature-specific-sc-container {
          width: inherit;
          margin-top: 0px;
          display: flex;
          flex-direction: column;
          justify-content: flex-start;
          row-gap: 10px;
          border-left: none;
          padding-top: 0px;
          padding-left: 0px;
          padding-right: 10px;
          padding-bottom: 10px;
          min-height: 650px;
          background-color: white;
          border-top-right-radius: 15px;
        }

        .displayOnClick {
          display: none;
        }

        .scenario-item-box {
          display: flex;
          flex-direction: column;
          justify-content: space-between;
          border: 0.1px solid var(--border-color);
          padding: 10px;
          box-shadow: 2px 2px 15px 2px #e3e2e2;
        }

        .scenario-item {
          display: flex;
          flex-direction: column;
          row-gap: 0px;
          border-right: 0.1px solid var(--border-color);
          border-left: 0.1px solid var(--border-color);
          border-bottom: 0.1px solid var(--border-color);
        }

        .scenario-name {
          min-height: 40px;
          display: flex;
          flex-direction: row;
          justify-content: space-between;
          align-items: center;
          padding-left: 10px;
          border-bottom: 0.1px solid var(--border-color);
          border-top: 0.1px solid var(--border-color);
          cursor: pointer;
        }

        .scenario-name:hover,
        .step-name:hover {
          background-color: #DDE6ED;
        }

        .scenario-hook-section {
          height: fit-content;
          display: grid;
          grid-template-columns: 20% 1fr;
          padding-left: 10px;
          border: 0.1px solid var(--border-color);
          cursor: pointer;
          background-color: #f4acb7;
          color: white;
          line-height: 19px;
          font-size: small;
        }

        .scenario-hook-error-value {
          line-height: 18px;
          font-size: smaller;
          max-height: fit-content;
          overflow: scroll;
          resize: vertical;
        }

        .scenario-expand-icon {
          margin-right: 20px;
        }

        .step-items {
          display: none;
          flex-direction: column;
          justify-content: space-between;
          row-gap: 10px;
          margin-left: 20px;
          margin-top: 10px;
          margin-right: 10px;
          border: 0.1px solid var(--border-color);
          margin-bottom: 10px;
          padding: 10px;
          box-shadow: 2px 2px 15px 2px #f0eded;
        }

        .step-item {
          line-height: 40px;
          padding-left: 0px;
          border: 0.1px solid var(--border-color);
          display: flex;
          flex-direction: column;
          justify-content: space-between;
          box-shadow: 2px 2px 15px 2px #e3e2e2;
        }

        .step-name {
          min-height: 40px;
          border-bottom: 0.1px solid var(--border-color);
          padding-left: 20px;
          display: flex;
          flex-direction: row;
          justify-content: space-between;
          align-items: center;
          padding-right: 30px;
          cursor: pointer;
        }

        .step-hook-error-section {
          flex: 1;
          display: grid;
          grid-template-columns: 20% 1fr;
          background-color: #f4acb7;
          color: white;
          line-height: 18px;
          height: fit-content;
        }

        .step-hook-error-value {
          line-height: 18px;
          font-size: small;
          max-height: fit-content;
          overflow: scroll;
          resize: vertical;
        }

        .step-info-section {
          display: none;
          flex-direction: column;
          justify-content: space-between;
          margin-bottom: 10px;
          margin-left: 40px;
          margin-top: 10px;
          margin-right: 10px;
          padding-left: 0px;
          border: 0.1px solid var(--border-color);
        }

        .step-error {
          background-color: #f4acb7;
          color: white;
          line-height: 18px;
          font-size: small;
          display: block;
          padding: 10px;
          max-height: fit-content;
          overflow: scroll;
          resize: vertical;
          cursor: text
        }

        .embedding-name {
          background-color: #f5edf0;
          padding-left: 20px;
        }

        .embedding-src {
          padding-left: 40px;
          color: #2660a4;
        }

        img {
          max-height: 100px;
          max-width: 150px;
          cursor: pointer;
        }



        /* New Grid.Js */



        #overall-stats-data-output-container,
        #feature-stats-data-output-container {
          background-color: #eaecf0;
          border-radius: 5px;
          padding: 20px;
        }

        #overall-stats-data-output-container table tbody tr td {
          text-align: center !important;
        }

        #feature-stats-data-output-container table tbody tr td:first-child {
          text-align: left !important;
          word-break: break-all !important;
          word-wrap: break-word !important;
          width: 30%;
        }

        #feature-stats-data-output-container table tbody tr td:nth-child(11) {
          text-align: left !important;
        }

        .gridjs-sort {
          background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA9UlEQVR4nOWWvQrCUAyF+wKCIDgItkmLCC4OTi5OTq6+g68jqDd18IlcOrg4ODg4CILSREUnpYoKgvjXBsQDZ/5uwklyLevvhcTNyIk2AknqQLwDw3vXXzcSgTj9sAokgiSHs3kLPa7FCgF/XUaS5Q0iJwNJ6NGmEgvE9cMCGJ7fQ/ACM7KwfS59BfHMNo/E00cQvNjwzO6s8LNKSLJoZPwUQtfKJvnuJvcWxGmv0kgcvArBK4xHuW6YeQlSHCxSQDx8F4K3NAbRQ5+CohQBcesbe3El8bek1rqiVhjU4q06sKorSHWpqp4J1cOnespVPyfWL+gInQoGedSzUpkAAAAASUVORK5CYII=) !important;
          opacity: 1 !important;
        }

        .passed-status {
          color: #008000;
          text-align: center;
          font-weight: bold;
        }

        .failed-status {
          color: #e01e37;
          text-align: center;
          font-weight: bold;
        }

        .skipped-status {
          color: #C0C0C0;
          text-align: center;
          font-weight: bold;
        }

        .known-failures-status {
          color: #FFC300;
          text-align: center;
          font-weight: bold;
        }

        .passed-with-known-failures-status {
          color: #73e2a7;
          text-align: center;
          font-weight: bold;
        }
    </style>
    <title>Easy Cucumber Report</title>

</head>

<body>

<div class="content">
    <!-- Title -->
    <div class="report-title">
        <p>
            <!-- <a href="https://lh6.googleusercontent.com/8l_RChnDWOMe4cSRQgKGCUxgSpZMG3SFJD1DMz0ib-smItV-nJztVWsQMsMkUoGV_MlwQ9sj_l_M7G0qTkjW4wk" data-lightbox="easy-cucumber-report-logo" data-title="Logo">
              <img
                class="logo"
                src="https://lh6.googleusercontent.com/8l_RChnDWOMe4cSRQgKGCUxgSpZMG3SFJD1DMz0ib-smItV-nJztVWsQMsMkUoGV_MlwQ9sj_l_M7G0qTkjW4wk"
                alt="ECR">
            </a> -->
            Easy Cucumber Report <span class="version">[Beta Version 1.0.0]</span></p>
    </div>

    <!-- Overall Status Highlight -->
    <div class="over-all-highlight-section"></div>

    <!-- project info section -->
    <div class="project-info-header">
        Project Information
    </div>
    <div class="project-details-container">
        <div class="project-info-flex" id="project-info-flex"></div>
        <div class="project-desc-info" id="project-desc-info"></div>
    </div>

    <!-- Chart Area -->

    <div class="chart-section-header">
        Charts
    </div>

    <div class="chart-area">

        <div class="chart-section-element feature-pie-chart-section">
            <div class="pie-chart">
                <canvas id="featurePieChart"></canvas>
            </div>
        </div>

        <div class="chart-section-element testcase-pie-chart-section">
            <div class="pie-chart">
                <canvas id="testCasePieChart"></canvas>
            </div>
        </div>

        <!-- <div class="chart-section-element teststep-pie-chart-section">
          <div class="pie-chart"><canvas id="testStepePieChart"></canvas></div>
        </div> -->

        <div class="chart-section-element defect-pie-chart-section">
            <div class="pie-chart">
                <canvas id="defectPieChart"></canvas>
            </div>
        </div>

    </div>

    <!-- stats table-->
    <div class="stats-tables">
        <!-- it shows overall status-->
        <div class="overall-stats-section">
            <div class="overall-stats-header">Overall Summary</div>
            <div id="overall-stats-data-output-container"></div>
        </div>

        <!-- it shows featurewise stats-->
        <div class="feature-stats-section">
            <div class="feature-stats-header">Features Summary</div>
            <div id="feature-stats-data-output-container"></div>
        </div>
    </div>

    <!-- Featuer, sceanrios and its steps along with execution error details and screenshots -->
    <div class="complete-result-section-header">Test Results</div>
    <div class="complete-result-section-container">
        <div id="complete-result-section" class="complete-result-section"></div>
    </div>

</div>
<!-- https://gridjs.io/docs -->
<script src="https://unpkg.com/gridjs/dist/gridjs.umd.js"></script>
<script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
<!-- lightbox2.js : to view images on popup -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/js/lightbox.js"
        integrity="sha512-MBa5biLyZuJEdQR7TkouL0i1HAqpq8lh8suPgA//wpxGx4fU1SGz1hGSlZhYmm+b7HkoncCWpfVKN3NDcowZgQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
    var json = `
    <<json-input>>
    `;


// Read Json Data
var data = JSON.parse(json);

// populate overall status on top of the report
let overallStatusParentElement = document.querySelector(".over-all-highlight-section");
var overAllStatusInnerElement = " ";
var overallStatus = data.overAllExecutionStatus;
if (overallStatus == "passed") {
  overAllStatusInnerElement = `<div class="over-all-highlight" style="background-color:#008000;">${overallStatus.toUpperCase()}</div>`;
} else if (overallStatus == "failed") {
  overAllStatusInnerElement = `<div class="over-all-highlight" style="background-color:#e01e37;">${overallStatus.toUpperCase()}</div>`;
} else if (overallStatus == "skipped") {
  overAllStatusInnerElement = `<div class="over-all-highlight" style="background-color:#C0C0C0 ; color:white; font-weight:bold;">${overallStatus.toUpperCase()}</div>`;
} else if (overallStatus == "known failures") {
  overAllStatusInnerElement = `<div class="over-all-highlight" style="background-color:#FFC300 ; color:#008000; font-weight:bold;">${overallStatus.toUpperCase()}</div>`;
} else if (overallStatus == "passed with known failures") {
  overAllStatusInnerElement = `<div class="over-all-highlight" style="background-color:#85e74d ; color:white; font-weight:bold;">${overallStatus.toUpperCase()}</div>`;
} else {
  overAllStatusInnerElement = `<div class="over-all-highlight" style="background-color:#C0C0C0 ; color:white; font-weight:bold;">No Results Found</div>`;
}

overallStatusParentElement.innerHTML = overAllStatusInnerElement;

// project info section
var projectInfo = data.projectInfo;

let projectInfoFlexParentElemnt = document.querySelector("#project-info-flex");
var projectInfoGridInnerElement = " ";

projectInfoGridInnerElement = `

<div class="info-section info-section-a">
  <div class="project-info-element project-info-key">Environment</div>
  <div class="project-info-element project-info-separator">:</div>
  <div class="project-info-element project-info-value">${projectInfo.environment}</div>

  <div class="project-info-element project-info-key">Browser</div>
  <div class="project-info-element project-info-separator">:</div>
  <div class="project-info-element project-info-value">${projectInfo.browser}</div>

  <div class="project-info-element project-info-key">Application</div>
  <div class="project-info-element project-info-separator">:</div>
  <div class="project-info-element project-info-value">${projectInfo.appName}</div>

  <div class="project-info-element project-info-key last-row">OS</div>
  <div class="project-info-element project-info-separator">:</div>
  <div class="project-info-element project-info-value">${projectInfo.os}</div>
</div>

<div class="info-section info-section-b">
  <div class="project-info-element project-info-key">Start Time</div>
  <div class="project-info-element project-info-separator">:</div>
  <div class="project-info-element project-info-value">${projectInfo.startTime}</div>

  <div class="project-info-element project-info-key">End Time</div>
  <div class="project-info-element project-info-separator">:</div>
  <div class="project-info-element project-info-value">${projectInfo.endTime}</div>

  <div class="project-info-element project-info-key">Elapsed Time</div>
  <div class="project-info-element project-info-separator">:</div>
  <div class="project-info-element project-info-value">${projectInfo.totalDuration}</div>

  <div class="project-info-element project-info-key"></div>
  <div class="project-info-element project-info-separator"></div>
  <div class="project-info-element project-info-value"></div>

</div>

<div class="info-section info-section-b">
  <div class="project-info-element project-info-key">Release Name</div>
  <div class="project-info-element project-info-separator">:</div>
  <div class="project-info-element project-info-value">${projectInfo.releaseName}</div>

  <div class="project-info-element project-info-key">Release Date</div>
  <div class="project-info-element project-info-separator">:</div>
  <div class="project-info-element project-info-value">${projectInfo.releaseDate}</div>

  <div class="project-info-element project-info-key">Sprint Name</div>
  <div class="project-info-element project-info-separator">:</div>
  <div class="project-info-element project-info-value">${projectInfo.sprint}</div>

  <div class="project-info-element project-info-key"></div>
  <div class="project-info-element project-info-separator"></div>
  <div class="project-info-element project-info-value"></div>

</div>

<div class="info-section info-section-c">
  <div class="project-info-element project-info-key">Project Manager</div>
  <div class="project-info-element project-info-separator">:</div>
  <div class="project-info-element project-info-value">${projectInfo.projectManager}</div>

  <div class="project-info-element project-info-key">DQ Manager</div>
  <div class="project-info-element project-info-separator">:</div>
  <div class="project-info-element project-info-value">${projectInfo.dqManager}</div>

  <div class="project-info-element project-info-key">DQ Lead</div>
  <div class="project-info-element project-info-separator">:</div>
  <div class="project-info-element project-info-value">${projectInfo.dqLead}</div>

  <div class="project-info-element project-info-key"></div>
  <div class="project-info-element project-info-separator"></div>
  <div class="project-info-element project-info-value"></div>
</div>



`;
projectInfoFlexParentElemnt.innerHTML = projectInfoGridInnerElement;

// project description section
let projectDescInfoParentElemnt = document.querySelector("#project-desc-info");
var projectDescInfoInnerElement = " ";

projectInfoGridInnerElement = `
<div class="description-section info-section-d">
  <div class="project-info-element project-info-key project-desc-header">Project Description / Release Notes :</div>
  <div class="project-info-element project-info-value project-desc-value">${projectInfo.descriptionOrReleaseNotes}</div>
</div>
`;

projectDescInfoParentElemnt.innerHTML = projectInfoGridInnerElement;


// Load pie charts for feature, test case and test steps on loading the page
// refer Chart.js library : https://www.chartjs.org/docs/latest/samples/other-charts/doughnut.html

// feature pie chart
// CenterText Plugin
const featureCenterText = {
  afterDatasetsDraw(chart) {
    const {ctx} = chart;
    const text = data.featurePieChartDataMap.totalFeatures;
    ctx.save();
    const x = chart.getDatasetMeta(0).data[0].x;
    const y = chart.getDatasetMeta(0).data[0].y;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.font = 'bold 15px sans-serif';
    ctx.fillText(text, x, y);
  }
}

let featureLabels = [
  "Passed",
  "Failed",
  "Skipped",
  "Known Failures",
  "Passed With Known Failures"
];

let featurePieDataSet = [
  data.featurePieChartDataMap.passed,
  data.featurePieChartDataMap.failed,
  data.featurePieChartDataMap.skipped,
  data.featurePieChartDataMap.knownFailures,
  data.featurePieChartDataMap.passedWithKnownFailures
];

const featureChartConfig = {
  type: "doughnut",
  data: {
    labels: featureLabels,
    datasets: [
      {
        label: 'Count',
        data: featurePieDataSet,
        backgroundColor: [
          '#008000',
          '#e01e37',
          '#C0C0C0',
          '#FFC300',
          '#73e2a7'
        ]
      }
    ]
  },
  options: {
    radius: 65, // outer radius
    animation: {
      animateScale: true // effect while loading page
    },
    cutout: 15, // inner radius
    maintainAspectRatio: false, // adopt as per container element
    responsive: true,  // adopt as per container element
    plugins: {
      // chart title
      title: {
        display: true,
        text: 'Feature Status',
        position: 'top',
        font: {
          weight: 'bold'
        },
        color: 'grey',
        padding: {
          top: 0,
          bottom: 50
        }
      },
      // chart legend
      legend: {
        display: true,
        position: 'right',
        align: 'start',
        rtl: false,
        title: {
          color: '#03256c',
          display: true,
          text: 'Status',
          font: {
            weight: 'bold'
          }
        },
        // chart legend text & color box prop
        labels: {
          boxWidth: 10,
          textAlign: 'left'
        }
      },
      tooltip: {
        enabled: true
      },
      // this will work only if we included plugin " plugins: [ChartDataLabels] "
      // It helps to show data over the doughnut colored area
      // need to import plugin "chartjs-plugin-datalabels" library
      // check video "https://www.youtube.com/watch?v=hyyIX_8Xe8w" for more info
      datalabels: {
        color: 'white',
        font: {
          weight: 'bold'
        },
        formatter: (value, context) => {
          // const datapoints = context.chart.data.datasets[0].data;
          // function totalSum(total, dataPoint) {
          //   return total + dataPoint;
          // }

          // const totalValue = datapoints.reduce(totalSum, 0);
          // const percentageValue = (value / totalValue * 100).toFixed(0);
          // return `${percentageValue}%`;
          return value == 0 ? null : value;
        }
      },
      // this will work only if we included plugin <script src="https://unpkg.com/chart.js-plugin-labels-dv/dist/chartjs-plugin-labels.min.js">
      // No need to register the plugin via " plugins: []". It is just enough to add above library "chartjs-plugin-labels-dv" in html
      // Check URL : https://www.npmjs.com/package/chart.js-plugin-labels-dv
      // Also check video "https://www.youtube.com/watch?v=xpN394MAhPA"
      // It helps to show % values outside the chart with easy configs
      labels: {
        render: 'percentage',
        precision: 0,
        showZero: false,
        fontStyle: 'bold',
        position: 'outside',
        textShadow: true,
        arc: true
        // fontColor: data.datasets[0].backgroundColor
      }
    },
    layout: {
      padding: {
        bottom: 60
      }
    }
  },
  plugins: [ChartDataLabels, featureCenterText]

};



const featureDoughnutChart = new Chart(
  document.querySelector("#featurePieChart"),
  featureChartConfig
)

// testcase pie chart
// CenterText Plugin
const testCaseCenterText = {
  afterDatasetsDraw(chart) {
    const {ctx} = chart;
    const text = data.testCasePieChartDataMap.totalCases;
    ctx.save();
    const x = chart.getDatasetMeta(0).data[0].x;
    const y = chart.getDatasetMeta(0).data[0].y;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.font = 'bold 15px sans-serif';
    ctx.fillText(text, x, y);
  }
}

let testCaseLabels = ["Passed", "Failed", "Skipped", "Known Failures"];
let testCasePieDataSet = [
  data.testCasePieChartDataMap.passed,
  data.testCasePieChartDataMap.failed,
  data.testCasePieChartDataMap.skipped,
  data.testCasePieChartDataMap.knownFailures
];

const testCaseChartConfig = {
  type: "doughnut",
  data: {
    labels: testCaseLabels,
    datasets: [
      {
        label: 'Count',
        data: testCasePieDataSet,
        backgroundColor: [
          '#008000',
          '#e01e37',
          '#C0C0C0',
          '#FFC300'
        ]
      }
    ]
  },
  options: {
    radius: 65, // outer radius
    animation: {
      animateScale: true // effect while loading page
    },
    cutout: 15, // inner radius
    maintainAspectRatio: false, // adopt as per container element
    responsive: true,  // adopt as per container element
    plugins: {
      // chart title
      title: {
        display: true,
        text: 'TestCase Status',
        position: 'top',
        font: {
          weight: 'bold'
        },
        color: 'grey',
        padding: {
          top: 0,
          bottom: 50
        }
      },
      // chart legend
      legend: {
        display: true,
        position: 'right',
        align: 'start',
        rtl: false,
        title: {
          color: '#03256c',
          display: true,
          text: 'Status',
          font: {
            weight: 'bold'
          }
        },
        // chart legend text & color box prop
        labels: {
          boxWidth: 10,
          textAlign: 'left'
        }
      },
      tooltip: {
        enabled: true
      },
      // this will work only if we included plugin " plugins: [ChartDataLabels] "
      // It helps to show data over the doughnut colored area
      // need to import plugin "chartjs-plugin-datalabels" library
      // check video "https://www.youtube.com/watch?v=hyyIX_8Xe8w" for more info
      datalabels: {
        color: 'white',
        font: {
          weight: 'bold'
        },
        formatter: (value, context) => {
          // const datapoints = context.chart.data.datasets[0].data;
          // function totalSum(total, dataPoint) {
          //   return total + dataPoint;
          // }

          // const totalValue = datapoints.reduce(totalSum, 0);
          // const percentageValue = (value / totalValue * 100).toFixed(0);
          // return `${percentageValue}%`;
          return value == 0 ? null : value;
        }
      },
      // this will work only if we included plugin <script src="https://unpkg.com/chart.js-plugin-labels-dv/dist/chartjs-plugin-labels.min.js">
      // No need to register the plugin via " plugins: []". It is just enough to add above library "chartjs-plugin-labels-dv" in html
      // Check URL : https://www.npmjs.com/package/chart.js-plugin-labels-dv
      // Also check video "https://www.youtube.com/watch?v=xpN394MAhPA"
      // It helps to show % values outside the chart with easy configs
      labels: {
        render: 'percentage',
        precision: 0,
        showZero: false,
        fontStyle: 'bold',
        position: 'outside',
        textShadow: true,
        arc: true
        // fontColor: data.datasets[0].backgroundColor
      }
    },
    layout: {
      padding: {
        bottom: 60
      }
    }
  },
  plugins: [ChartDataLabels, testCaseCenterText]

};

const doughnutChart = new Chart(
  document.querySelector("#testCasePieChart"),
  testCaseChartConfig
)

// testStep pie chart
// CenterText Plugin
const testStepCenterText = {
  afterDatasetsDraw(chart) {
    const {ctx} = chart;
    const text = data.testStepPieChartDataMap.totalSteps;
    ctx.save();
    const x = chart.getDatasetMeta(0).data[0].x;
    const y = chart.getDatasetMeta(0).data[0].y;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.font = 'bold 15px sans-serif';
    ctx.fillText(text, x, y);
  }
}

let testStepLabels = ["Passed", "Failed", "Skipped", "Known Failures", "Pending", "Undefined", "Ambiguous", "Unused"];
let testStepPieDataSet = [
  data.testStepPieChartDataMap.passed,
  data.testStepPieChartDataMap.failed,
  data.testStepPieChartDataMap.skipped,
  data.testStepPieChartDataMap.knownFailures,
  data.testStepPieChartDataMap.pending,
  data.testStepPieChartDataMap.undefined,
  data.testStepPieChartDataMap.ambiguous,
  data.testStepPieChartDataMap.unused,
];

const stepChartConfig = {
  type: "doughnut",
  data: {
    labels: testStepLabels,
    datasets: [
      {
        label: 'Count',
        data: testStepPieDataSet,
        backgroundColor: [
          '#008000',
          '#e01e37',
          '#C0C0C0',
          '#FFC300',
          '#f72585',
          '#124559',
          '#aed9e0',
          '#8a817c'
        ]
      }
    ]
  },
  options: {
    radius: 65, // outer radius
    animation: {
      animateScale: true // effect while loading page
    },
    cutout: 15, // inner radius
    maintainAspectRatio: false, // adopt as per container element
    responsive: true,  // adopt as per container element
    plugins: {
      // chart title
      title: {
        display: true,
        text: 'Step Status',
        position: 'top',
        font: {
          weight: 'bold'
        },
        color: 'grey',
        padding: {
          top: 0,
          bottom: 50
        }
      },
      // chart legend
      legend: {
        display: true,
        position: 'right',
        align: 'start',
        rtl: false,
        title: {
          color: '#03256c',
          display: true,
          text: 'Status',
          font: {
            weight: 'bold'
          }
        },
        // chart legend text & color box prop
        labels: {
          boxWidth: 10,
          textAlign: 'left'
        }
      },
      tooltip: {
        enabled: true
      },
      // this will work only if we included plugin " plugins: [ChartDataLabels] "
      // It helps to show data over the doughnut colored area
      // need to import plugin "chartjs-plugin-datalabels" library
      // check video "https://www.youtube.com/watch?v=hyyIX_8Xe8w" for more info
      datalabels: {
        color: 'white',
        font: {
          weight: 'bold'
        },
        formatter: (value, context) => {
          // const datapoints = context.chart.data.datasets[0].data;
          // function totalSum(total, dataPoint) {
          //   return total + dataPoint;
          // }

          // const totalValue = datapoints.reduce(totalSum, 0);
          // const percentageValue = (value / totalValue * 100).toFixed(0);
          // return `${percentageValue}%`;
          return value == 0 ? null : value;
        }
      },
      // this will work only if we included plugin <script src="https://unpkg.com/chart.js-plugin-labels-dv/dist/chartjs-plugin-labels.min.js">
      // No need to register the plugin via " plugins: []". It is just enough to add above library "chartjs-plugin-labels-dv" in html
      // Check URL : https://www.npmjs.com/package/chart.js-plugin-labels-dv
      // Also check video "https://www.youtube.com/watch?v=xpN394MAhPA"
      // It helps to show % values outside the chart with easy configs
      labels: {
        render: 'percentage',
        precision: 0,
        showZero: false,
        fontStyle: 'bold',
        position: 'outside',
        textShadow: true,
        arc: true
        // fontColor: data.datasets[0].backgroundColor
      }
    },
    layout: {
      padding: {
        bottom: 60
      }
    },
    elements: {
      arc: {
        // borderColor:
      }
    }
  },
  plugins: [ChartDataLabels, testStepCenterText]

};

const stepDoughnutChart = new Chart(
  document.querySelector("#testStepePieChart"),
  stepChartConfig
)

// defect pie chart
const reducer = (accumulator, curr) => accumulator + curr;
var totalDefects = data.defectPieChartDataMap.trackedKnownDefects
+ data.defectPieChartDataMap.unTrackedKnownDefects
+ data.defectPieChartDataMap.newDefects
+ data.defectPieChartDataMap.otherDefects;
totalDefects = totalDefects > 0 ? totalDefects : 'No Defects';

// CenterText Plugin
const defectCenterText = {
  afterDatasetsDraw(chart) {
    const {ctx} = chart;
    const text = totalDefects; //chart.data.datasets[0].data.reduce(reducer);
    ctx.save();
    const x = chart.getDatasetMeta(0).data[0].x;
    const y = chart.getDatasetMeta(0).data[0].y;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.font = 'bold 15px sans-serif';
    ctx.fillText(text, x, y);
  }
}

let defectCategoryLabel = ["Tracked-KnownFailure", "UnTracked-KnownFailure", "NewFailure", "Other Failures"];
let defectPieDataSet = [
  data.defectPieChartDataMap.trackedKnownDefects,
  data.defectPieChartDataMap.unTrackedKnownDefects,
  data.defectPieChartDataMap.newDefects,
  data.defectPieChartDataMap.otherDefects
];

const defectChartConfig = {
  type: "doughnut",
  data: {
    labels: defectCategoryLabel,
    datasets: [
      {
        label: 'Count',
        data: defectPieDataSet,
        backgroundColor: [
          '#60d394',
          '#aaf683',
          '#ff5a5f',
          '#c81d25'
        ]
      }
    ]
  },
  options: {
    radius: 65, // outer radius
    animation: {
      animateScale: true // effect while loading page
    },
    cutout: 15, // inner radius
    maintainAspectRatio: false, // adopt as per container element
    responsive: true,  // adopt as per container element
    plugins: {
      // chart title
      title: {
        display: true,
        text: 'Defect Status',
        position: 'top',
        font: {
          weight: 'bold'
        },
        color: 'grey',
        padding: {
          top: 0,
          bottom: 50
        }
      },
      // chart legend
      legend: {
        display: true,
        position: 'right',
        align: 'start',
        rtl: false,
        title: {
          color: '#03256c',
          display: true,
          text: 'Status',
          font: {
            weight: 'bold'
          }
        },
        // chart legend text & color box prop
        labels: {
          boxWidth: 10,
          textAlign: 'left'
        }
      },
      tooltip: {
        enabled: true
      },
      // this will work only if we included plugin " plugins: [ChartDataLabels] "
      // It helps to show data over the doughnut colored area
      // need to import plugin "chartjs-plugin-datalabels" library
      // check video "https://www.youtube.com/watch?v=hyyIX_8Xe8w" for more info
      datalabels: {
        color: 'white',
        font: {
          weight: 'bold'
        },
        formatter: (value, context) => {
          // const datapoints = context.chart.data.datasets[0].data;
          // function totalSum(total, dataPoint) {
          //   return total + dataPoint;
          // }

          // const totalValue = datapoints.reduce(totalSum, 0);
          // const percentageValue = (value / totalValue * 100).toFixed(0);
          // return `${percentageValue}%`;
          return value == 0 ? null : value;
        }
      },
      // this will work only if we included plugin <script src="https://unpkg.com/chart.js-plugin-labels-dv/dist/chartjs-plugin-labels.min.js">
      // No need to register the plugin via " plugins: []". It is just enough to add above library "chartjs-plugin-labels-dv" in html
      // Check URL : https://www.npmjs.com/package/chart.js-plugin-labels-dv
      // Also check video "https://www.youtube.com/watch?v=xpN394MAhPA"
      // It helps to show % values outside the chart with easy configs
      labels: {
        render: 'percentage',
        precision: 0,
        showZero: false,
        fontStyle: 'bold',
        position: 'outside',
        textShadow: true,
        arc: true
        // fontColor: data.datasets[0].backgroundColor
      }
    },
    layout: {
      padding: {
        bottom: 60
      }
    },
    elements: {
      arc: {
        // borderColor:
      }
    }
  },
  plugins: [ChartDataLabels, defectCenterText]

};

const defectDoughnutChart = new Chart(
  document.querySelector("#defectPieChart"),
  defectChartConfig
)


// load overall testcase stats table - starts
var overallTestCaseData = data.overallTestCaseStats;

var overAllStatsTable = new gridjs.Grid({
  columns: [
    {
      id: "totalCases",
      name: "Total"
    },
    {
      id: "passed",
      name: "Pass"
    },
    {
      id: "failed",
      name: "Fail"
    },
    {
      id: "skipped",
      name: "Skip"
    },
    {
      id: "knownFailures",
      name: "Known Fails"
    },
    {
      id: "passPercent",
      name: "Pass %"
    },
    {
      id: "failPercent",
      name: "Fail %"
    },
    {
      id: "skippedPercent",
      name: "Skip %"
    },
    {
      id: "knownFailPercent",
      name: "Known Fail %"
    },
    {
      id: "overAllStatus",
      name: "Status",
      formatter: (cell) => {
        return cell.toUpperCase();
      },
      attributes: (cell) => {
        if (cell == "passed") {
          return {
            'class': 'gridjs-td passed-status'
          };
        } else if (cell == "failed") {
          return {
            'class': 'gridjs-td failed-status'
          };
        } else if (cell == "skipped") {
          return {
            'class': 'gridjs-td skipped-status'
          };
        } else if (cell == "known failures") {
          return {
            'class': 'gridjs-td known-failures-status'
          };
        } else if (cell == "passed with known failures") {
          return {
            'class': 'gridjs-td passed-with-known-failures-status'
          };
        }
      }

    },
    {
      id: "overallDuration",
      name: "Duration"
    }
  ],
  autowidth: true,
  style: {
    table: {
      'box-shadow': '2px 2px 15px 2px #C0C0C0'
    },
    th: {
      'background-color': '#03045e',
      color: 'white',
      'min-width': 'fit-content !important',
      'text-align': 'center',
      'padding-left': '10px',
      'padding-right': '10px'
    },
    td: {
      'text-align': 'center',
      'padding-left': '10px',
      'padding-right': '10px'
    }
  },
  data: [overallTestCaseData]

});
overAllStatsTable.render(document.getElementById("overall-stats-data-output-container"));
// load overall testcase stats table - ends

// load feature stats table - starts
let out = "";
var featuresList = data.featuresStats;

var table = new gridjs.Grid({
  columns: [
    {
      id: "featureName",
      name: "Feature Name",
      sort: true
    },
    {
      id: "totalCases",
      name: "Total"
    },
    {
      id: "passed",
      name: "Pass"
    },
    {
      id: "failed",
      name: "Fail"
    },
    {
      id: "skipped",
      name: "Skip"
    },
    {
      id: "knownFailures",
      name: "Known Fails"
    },
    {
      id: "passPercent",
      name: "Pass %"
    },
    {
      id: "failPercent",
      name: "Fail %"
    },
    {
      id: "skippedPercent",
      name: "Skip %"
    },
    {
      id: "knownFailPercent",
      name: "Known Fail %"
    },
    {
      id: "status",
      name: "Status",
      sort: true,
      formatter: (cell) => {
        return cell.toUpperCase();
      },
      attributes: (cell) => {
        if (cell == "passed") {
          return {
            'class': 'gridjs-td passed-status'
          };
        } else if (cell == "failed") {
          return {
            'class': 'gridjs-td failed-status'
          };
        } else if (cell == "skipped") {
          return {
            'class': 'gridjs-td skipped-status'
          };
        } else if (cell == "known failures") {
          return {
            'class': 'gridjs-td known-failures-status'
          };
        } else if (cell == "passed with known failures") {
          return {
            'class': 'gridjs-td passed-with-known-failures-status'
          };
        }
      }

    },
    {
      id: "duration",
      name: "Duration"
    }
  ],
  pagination: {
    limit: 10,
    summary: true
  },
  search: true,
  autowidth: true,
  resizable: true,
  style: {
    table: {
      'box-shadow': '2px 2px 15px 2px #C0C0C0'
    },
    th: {
      'background-color': '#03045e',
      color: 'white',
      'min-width': 'fit-content !important',
      'text-align': 'center',
      'padding-left': '10px',
      'padding-right': '10px'
    },
    td: {
      'text-align': 'center',
      'padding-left': '10px',
      'padding-right': '10px'
    }
  },
  data: featuresList

});
table.render(document.getElementById("feature-stats-data-output-container"));
// load feature stats table - ends

// Display features, its scenarios, its steps and its screenshots
var features = data.featureMapList;

// it consist of whole elements
var completeResultSectionParentElement = document.querySelector("#complete-result-section");
var featureListElement = getFeatureElements(features);
var content = getContentToDisplayOnRightWhenClickingFeatureNavLink(features);
var testResultSectionContainerElement = `

  <section class="complete-result-container">
    <div class="feature-column">Features</div>
    <div class="scenario-and-step-results-column">Scenarios & Steps Results</div>
    <nav>
      <ul>
        ${featureListElement}
      </ul>
    </nav>

    <div class="feature-specific-sc-container" id="loadOnClick" style=" float: right;">

    </div>
  </section>

  ${content}

  `;

completeResultSectionParentElement.innerHTML = testResultSectionContainerElement;

$(document).ready(function () { $("img").click(function () { this.requestFullscreen() }) });

function getContentToDisplayOnRightWhenClickingFeatureNavLink(features) {
  var displayOnClickContent = "";
  for (let feature of features) {
    // get all scenario elements to be displayed on right side page
    var scenarioElements = getScenarioElements(feature.scenarios);

    // then build the content panel section with above scenario elements
    // for every feature
    displayOnClickContent += `
      <div id="${feature.id}" class="displayOnClick">
        ${scenarioElements}
      </div>
      `;
  }
  return displayOnClickContent;
}

function getFeatureElements(features) {
  var featureListElement = "";
  var i = 1;
  for (let feature of features) {
    var statusCell = getFeatureNavigationLineStatusColor(feature.status);
    var featureId = replaceEscapesAndHtmlWithHyphen(feature.id);

    // prepare left side features link as li
    featureListElement += `
    <li class="side-nav-item">
      <a
        id="${featureId}-a"
        href="#${featureId}"
        class="featureLinks"
        onclick='loadScenarioContent("#${featureId}")'>
        Feature ${i} : ${atob(feature.name)}
      </a>
      <span>${feature.duration}</span>
      ${statusCell}
    </li>
    `;
    i++;
  }
  return featureListElement;
}

function getScenarioElements(scenarios) {
  var scenarioElements = "";
  var i = 1;
  for (let scenario of scenarios) {
    var steps = scenario.steps;
    var stepElements = getStepElements(steps);
    var scLineColor = getScenarioLineColorBasedOnStatus(scenario.status);
    var scenarioId = replaceEscapesAndHtmlWithHyphen(scenario.id);

    var beforeScenarioError = "";
    if (scenario.beforeError.length != 0) {
      var beforeScenarioErrorDecoded = atob(scenario.beforeError);
      beforeScenarioError = `
        <div class="scenario-hook-section">
          <div class="scenario-hook-error-key">Scenario ${i} BeforeScenario-Hook-Error : </div>
          <div class="scenario-hook-error-value">${beforeScenarioErrorDecoded}</div>
        </div>
      `;
    }

    var afterScenarioError = "";
    if (scenario.afterError.length != 0) {
      var afterScenarioErrorDecoded = atob(scenario.afterError);
      afterScenarioError = `
        <div class="scenario-hook-section">
          <div class="scenario-hook-error-key">Scenario ${i} AfterScenario-Hook-Error : </div>
          <div class="scenario-hook-error-value">${afterScenarioErrorDecoded}</div>
        </div>
      `;
    }

    // Below is a box of scenario line and its steps details.
    // By default, steps are hidden [display : none]
    // On clicking scenario line, step is displayed
    scenarioElements += `
    <div class="scenario-item-box">
        ${beforeScenarioError}
        <div id="#${scenarioId}" class="scenario-item">
          <div id="#${scenarioId}-collapsible" class="scenario-name collapsible" onclick="collapseExpandScenario('#${scenarioId}-collapsible-content')">
            <div ${scLineColor}>Scenario ${i} : ${atob(scenario.name)}</div>
            <span class="fa-solid fa-angle-down scenario-expand-icon" style="color: #9eb3c2;"></span>
          </div>
          <div id="#${scenarioId}-collapsible-content" class="step-items">
            ${stepElements}
          </div>
        </div>
        ${afterScenarioError}
    </div>
      `;
    i++;
  }
  return scenarioElements;
}

function getStepElements(steps) {
  var stepElements = "";
  var i = 1;
  for (let step of steps) {
    var stepLineColor = getStepLineColorBasedOnStatus(step.status);
    var beforeStepError = "";
    if (step.beforeError.length != 0) {
      var beforeStepErrorDecoded = atob(step.beforeError);
      beforeStepError = `
        <div class="step-name">
          <div class="step-hook-error-section">
            <div>Step ${i} BeforeStep-Hook-Error : </div>
            <div class="step-hook-error-value">${beforeStepErrorDecoded}</div>
          </div>
        </div>
      `;
    }

    var afterStepError = "";
    if (step.afterError.length != 0) {
      var afterStepErrorDecoded = atob(step.afterError);
      afterStepError = `
      <div class="step-name">
        <div class="step-hook-error-section">
          <div>Step ${i} AfterStep-Hook-Error : </div>
          <div class="step-hook-error-value">${afterStepErrorDecoded}</div>
        </div>
      </div>
      `;
    }

    var stepError = "";

    if (step.error != null && step.error.length != 0) {
      var stepErrorDecoded = atob(step.error); // decodes the encoded error text
      stepError = `
        <div class="step-error">${stepErrorDecoded}</div>
      `;
    }

    var stepEmbeddings = getStepEmbeddingElements(step.embeddings, step.status);
    var stepName = atob(step.name);
    var stepNameForId = replaceEscapesAndHtmlWithHyphen(stepName);

    stepElements += `
      <div id="#${stepNameForId}-${step.line}" class="step-item">
        ${beforeStepError}
        <div
          id="#step-${stepNameForId}-${step.line}-collapsible"
          class="step-name" ${stepLineColor}
          onclick="collapseExpandStep('#step-${stepNameForId}-${step.line}-collapsible-content')">
            <div>Step ${i} : ${stepName}</div>
            <div><i class="fa-sharp fa-solid fa-circle"></i></div>
        </div>

        <div
          id="#step-${stepNameForId}-${step.line}-collapsible-content"
          class="step-info-section">
            ${stepError}
            ${stepEmbeddings}
        </div>
        ${afterStepError}
      </div>
    `;
    i++;
  }
  return stepElements;
}

function replaceEscapesAndHtmlWithHyphen(value) {
  return value.replaceAll("<br>", "-")
    .replaceAll("&emsp", "-")
    .replaceAll("'", "-")
    .replaceAll(";", "-")
    .replaceAll(" ", "-")
    .replaceAll("\\", "-")
    .replaceAll("/", "-")
    .replaceAll("\"", "-")
    .replaceAll(".", "-");
  }

function getStepEmbeddingElements(embeddings, stepStatus) {
  var stepEmbeddingElement = "";
  let index = 0;
  if (embeddings != null && embeddings.length > 0) {
    for (let embedding of embeddings) {
      index = index+1;
      var attachmentSource = getStepScreenshotElement(embedding.mime_type, embedding.data, embedding.name, index);
      if (isStepStatusIngnorable(stepStatus)) {
        stepEmbeddingElement += `
          <div>
          <div class="embedding-name">${embedding.name}</div>
          <div class="embedding-src">${attachmentSource}</div>
          <div class="embedding-name">${stepStatus} step</div>
          </div>
        `;
      } else {
        stepEmbeddingElement += `
          <div>
            <div class="embedding-name">${embedding.name}</div>
            <div class="embedding-src">${attachmentSource}</div>
          </div>
        `;
      }
    }
  } else {
    stepEmbeddingElement += `
          <div>
            <div class="embedding-name">${stepStatus}</div>
          </div>
        `;
  }

  return stepEmbeddingElement;
}

function getStepScreenshotElement(mimeType, encodedString, imageCaption, index) {
  if (mimeType == "text/plain") {
    return `<div>${encodedString}</div>`;
  } else {
    var uint8array = new TextEncoder("utf-8").encode(encodedString);
    var text = new TextDecoder().decode(uint8array);
    return `
    <a href="data:${mimeType};base64, ${text}" data-lightbox="image-${index}" data-title="${imageCaption}">
      <img src="data:${mimeType};base64, ${text}" alt="unable to find image source">
    </a>
    `;
  }
}
// {/* <img src="data:${mimeType};base64, ${text}" alt="unable to find image source"></img> */}
function isStepStatusIngnorable(stepStatus) {
  const ignorableStatuses = ['skipped', 'pending', 'undefined', 'ambiguous', 'unused'];
  return ignorableStatuses.includes(stepStatus);
}

// On selecting any feature link from left side navigation,
// clearing backgroup of other features
// add background only for selected feature
function loadScenarioContent(selector) {
  $("#loadOnClick").html($(selector).html());

  $("ul > li > a").on("click", function () {
    $("ul li a").css("color", "black");
    $("ul li a").css("background-color", "transparent");
    $("ul li a").css("border", "none");

    $("ul li").css("color", "black");
    $("ul li").css("background-color", "transparent");

    $(this).css("color", "white");
    $(this).css("background-color", "#03045e");
    $(this.parentNode).css("background-color", "#03045e");
  });
};

// when document becomes ready, it selects and highlights
// the first feature navigation option
$(document).ready(function () {
  var firstFeatureId = features[0].id
  document.querySelector("li a[href='#" + features[0].id + "']").parentNode.classList.add("side-nav-item-active");
  loadScenarioContent("#" + firstFeatureId);

});

function collapseExpandScenario(id) {

  if (document.getElementById(id).style.display == "flex") {
    document.getElementById(id).style.display = "none";
  } else {
    document.getElementById(id).style.display = "flex";
  }
}

function collapseExpandStep(id) {

  if (document.getElementById(id).style.display == "block") {
    document.getElementById(id).style.display = "none";
  } else {
    document.getElementById(id).style.display = "block";
  }
}

// jquery to click and open any image in fullscreen view
// pressing escape will close image
// $(document).ready(function () { $("img").click(function () { this.requestFullscreen() }) });
$('img').on("click", function () {
  var win = window.open();
  var url = $(this).attr("src");
  // var html = $("body").html("<textarea>" + url + "</textarea>");
  var html = $("body").html("<img src='" + url + "' target='_blank'");
  $(win.document.body).html(html);
});

function getFeatureNavigationLineStatusColor(featureStatus) {
  var statusCell = "";
  if (featureStatus == "passed") {
    statusCell = `<i class="fa-solid fa-circle-check status-icon" style="color: #0e920c;"></i>`;
  } else if (featureStatus == "failed") {
    statusCell = `<i class="fa-solid fa-circle-xmark status-icon" style="color: #f20202;"></i>`;
  } else if (featureStatus == "skipped") {
    statusCell = `<i class="fa-solid fa-circle-arrow-right status-icon" style="color: #c3c6cb;"></i>`;
  } else if (featureStatus == "known failures") {
    statusCell = `<i class="fa-solid fa-circle-exclamation status-icon" style="color: #f0cf75;"></i>`;
  } else if (featureStatus == "passed with known failures") {
    statusCell = `<i class="fa-solid fa-circle-exclamation status-icon" style="color: #73e2a7;"></i>`;
  } else {
    statusCell = "";
  }
  return statusCell;
}

function getStepLineColorBasedOnStatus(stepStatus) {
  var stepLineColor = "";
  if (stepStatus == "passed") {
    stepLineColor = "style='color: #008000'";
  } else if (stepStatus == "failed") {
    stepLineColor = "style='color: #e01e37'";
  } else if (stepStatus == "skipped") {
    stepLineColor = "style='color: #C0C0C0'";
  } else if (stepStatus == "known failures") {
    stepLineColor = "style='color: #FFC300'";
  } else if (stepStatus == "pending") {
    stepLineColor = "style='color: #f72585'";
  } else if (stepStatus == "undefined") {
    stepLineColor = "style='color: #124559'";
  } else if (stepStatus == "ambiguous") {
    stepLineColor = "style='color: #aed9e0'";
  } else if (stepStatus == "unused") {
    stepLineColor = "style='color: #8a817c'";
  }
  return stepLineColor;
}

function getScenarioLineColorBasedOnStatus(scenarioStatus) {
  var scLineColor = "";
  if (scenarioStatus == "passed") {
    scLineColor = "style='color: #008000'";
  } else if (scenarioStatus == "failed") {
    scLineColor = "style='color: #e01e37'";
  } else if (scenarioStatus == "skipped") {
    scLineColor = "style='color: #C0C0C0'";
  } else if (scenarioStatus == "known failures") {
    scLineColor = "style='color: #FFC300'";
  } else if (scenarioStatus == "passed with known failures") {
    scLineColor = "style='color: #73e2a7'";
  }
  return scLineColor;
}

// this is used to configure options for lightbox js library
// that helps to open images smoothly on a pop-up
// refer "https://lokeshdhakar.com/projects/lightbox2/" for more details
// To make it work, added js <script> tag and css <link> tags in the html file
lightbox.option({
  'resizeDuration': 600,
  'wrapAround': true
})


</script>


</body>

</html>